<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>gather (ServiceMetaData)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File app/service_meta_data.rb, line 43</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gather</span>
    <span class="ruby-ivar">@exposed_variables</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span>(<span class="ruby-ivar">@service</span>.<span class="ruby-identifier">runtime</span>.<span class="ruby-identifier">runScriptlet</span>(<span class="ruby-value str">%{
      vs = {:both =&gt; [], :read =&gt; [], :write =&gt; []}
      
      $service_manager.instance_variables.each do |m|
        r_meth = m.gsub(/\@/, &quot;&quot;).to_sym
        w_meth = (m.gsub(/\@/, &quot;&quot;)+&quot;=&quot;).to_sym

        if $service_manager.respond_to?(r_meth) &amp;&amp; $service_manager.respond_to?(w_meth)
          vs[:both]   &lt;&lt; r_meth.to_s         
          vs[:both]   &lt;&lt; w_meth.to_s              
          
        elsif $service_manager.respond_to?(w_meth)
          vs[:write]  &lt;&lt; w_meth.to_s
        elsif $service_manager.respond_to?(r_meth)
          vs[:read]   &lt;&lt; r_meth.to_s
        end
      end
      
      Marshal.dump(vs)
    }</span>))


    <span class="ruby-ivar">@expose</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span>(<span class="ruby-ivar">@service</span>.<span class="ruby-identifier">runtime</span>.<span class="ruby-identifier">runScriptlet</span>(<span class="ruby-value str">%{Marshal.dump($service_manager.limits.map{|e| e = e.to_s.downcase.to_sym})}</span>))
    
    <span class="ruby-identifier">get_readable_var_values</span>()
    <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{@service.path}/service_data.yml&quot;</span>))
      <span class="ruby-identifier">data</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>( <span class="ruby-node">&quot;#{@service.path}/service_data.yml&quot;</span> ) )
      <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
        <span class="ruby-ivar">@readable_var_values</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">v</span>
        <span class="ruby-ivar">@service</span>.<span class="ruby-identifier">runtime</span>.<span class="ruby-identifier">runScriptlet</span>(<span class="ruby-node">%{$service_manager.instance_variable_set(&quot;@#{k}&quot;, &quot;#{v}&quot;)}</span>)
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-comment cmt"># now delete it !</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{@service.path}/service_data.yml&quot;</span>)
    <span class="ruby-keyword kw">end</span>
    
    <span class="ruby-ivar">@service_methods</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span>(<span class="ruby-ivar">@service</span>.<span class="ruby-identifier">runtime</span>.<span class="ruby-identifier">runScriptlet</span>(<span class="ruby-value str">%{
      m = {:all =&gt; [], :exposed =&gt; []}
      $service_manager.all_methods.each {|e| m[:exposed] &lt;&lt; [e.to_s, $service_manager.class.all_parameter_methods[e.to_s] || [] ]}
      
      m[:all] = ($service_manager.public_methods-Object.public_instance_methods) - $service_manager.all_methods.map{|e| e.to_s } - [&quot;start&quot;, &quot;all_methods&quot;, &quot;stop&quot;, &quot;status=&quot;, &quot;status&quot;, &quot;limits&quot;, &quot;limit_expose_to&quot;, &quot;update&quot;]
      
      Marshal.dump(m)
    }</span>))
    
    <span class="ruby-ivar">@service_methods</span>[<span class="ruby-identifier">:all</span>] <span class="ruby-operator">-=</span> (<span class="ruby-ivar">@exposed_variables</span>[<span class="ruby-identifier">:read</span>] <span class="ruby-operator">+</span> <span class="ruby-ivar">@exposed_variables</span>[<span class="ruby-identifier">:both</span>] <span class="ruby-operator">+</span> <span class="ruby-ivar">@exposed_variables</span>[<span class="ruby-identifier">:write</span>])
  <span class="ruby-keyword kw">end</span></pre>
</body>
</html>